# Reference configuration for the SLIM OpenTelemetry Exporter
# This file demonstrates ALL possible configuration options
# Slim exporter config
slim:
  # REQUIRED: Address of the SLIM node where to connect
  # Format: "http://host:port" or "https://host:port"
  endpoint: "http://127.0.0.1:46357"
  
  # OPTIONAL: List of the exporter names for each signal type
  # These names identify this exporter in SLIM channels
  exporter-names:
    # Name for metrics producer
    # Add this name to your SLIM channel to receive metrics from this exporter
    # Default: "agntcy/otel/exporter-metrics"
    metrics: "agntcy/otel/exporter-metrics"
    
    # Name for traces producer
    # Add this name to your SLIM channel to receive traces from this exporter
    # Default: "agntcy/otel/exporter-traces"
    traces: "agntcy/otel/exporter-traces"
    
    # Name for logs producer
    # Add this name to your SLIM channel to receive logs from this exporter
    # Default: "agntcy/otel/exporter-logs"
    logs: "agntcy/otel/exporter-logs"
  
  # ============================================================================
  # AUTHENTICATION CONFIGURATION
  # ============================================================================
  # REQUIRED: Choose exactly ONE of the following authentication methods
  auth:
    # ------------------------------------------------------------------------
    # Method 1: Shared Secret Authentication
    # ------------------------------------------------------------------------
    # Simple symmetric key authentication
    # The secret must be at least 32 characters long
    # Use the same secret on both exporter and receiver
    shared-secret: "a-very-long-shared-secret-0123456789-abcdefg"
    
    # ------------------------------------------------------------------------
    # Method 2: Static JWT Token Authentication
    # ------------------------------------------------------------------------
    # Load a pre-generated JWT token from a file
    # The file is monitored and automatically reloaded on change
    static-jwt:
      # REQUIRED: Path to the file containing the JWT token
      file: "/path/to/jwt-token.txt"

      # OPTIONAL: Duration for token cache refresh
      # Default: "3600s" (1 hour)
      # Format: duration string (e.g., "30s", "5m", "1h", "3600s")
      duration: "3600s"
    
    # ------------------------------------------------------------------------
    # Method 3: Dynamic JWT Authentication with Signing Keys
    # ------------------------------------------------------------------------
    # Generate and sign JWTs dynamically using configured keys
    jwt:
      # JWT claims configuration
      claims:
        # OPTIONAL: Audience claim(s) - list of intended recipients
        # Can be a single audience or multiple audiences
        audience:
          - "slim"
          - "slim-service"
        
        # OPTIONAL: Issuer claim - identifies who issued the token
        issuer: "slim-exporter"
        
        # OPTIONAL: Subject claim - identifies the principal (this application)
        subject: "otel-exporter"
      
      # OPTIONAL: Token validity duration
      # Default: "3600s" (1 hour)
      # Format: duration string (e.g., "30s", "5m", "1h", "3600s")
      duration: "3600s"
      
      # REQUIRED: Key configuration for JWT signing
      # Exporters are JWT providers/signers, so use 'encoding' key
      # (Receivers are JWT verifiers, so they use 'decoding' key)
      key:
        # For EXPORTERS: Use 'encoding' with PRIVATE key for signing JWTs
        encoding:
          # REQUIRED: Algorithm for signing/verifying JWT
          # Options:
          #   HMAC:   HS256, HS384, HS512 (symmetric key)
          #   ECDSA:  ES256, ES384 (elliptic curve)
          #   RSA:    RS256, RS384, RS512 (RSA signature)
          #   RSA-PSS: PS256, PS384, PS512 (RSA-PSS signature)
          #   EdDSA:  EdDSA (Ed25519)
          algorithm: "RS256"
          
          # REQUIRED: Key format
          # Options:
          #   pem:  PEM-encoded key (most common)
          #   jwk:  JSON Web Key (single key)
          #   jwks: JSON Web Key Set (multiple keys)
          format: "pem"
          
          # REQUIRED: Key source - choose ONE
          key:
            # Option A: Load key from file
            file: "/path/to/private-key.pem"
            # Option B: Embed key directly in config
            data: "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC7...\n-----END PRIVATE KEY-----"
        
        # For RECEIVERS: Use 'decoding' with PUBLIC key for verifying JWTs
        decoding:
          algorithm: "RS256"
          format: "pem"
          key:
            # Option A: Load key from file
            file: "/path/to/public-key.pem"
            # Option B: Embed key directly in config
            data: "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"
    
    # ------------------------------------------------------------------------
    # Method 4: SPIRE Workload Identity Authentication
    # ------------------------------------------------------------------------
    # Use SPIRE (SPIFFE Runtime Environment) for workload identity
    # Requires SPIRE agent to be running and accessible
    # Not available on Windows
    spire:
      # OPTIONAL: Path to the SPIRE agent socket
      # Default: Uses SPIRE_AGENT_ADDRESS env var or standard socket location
      socket-path: "unix:///tmp/spire-agent/public/api.sock"
      
      # OPTIONAL: Target SPIFFE ID for the SLIM server you're connecting to
      # Used to verify the identity of the remote peer
      target-spiffe-id: "spiffe://example.org/slim-server"
      
      # OPTIONAL: JWT audience claims for SPIRE-issued JWTs
      # List of audiences to include in JWT tokens
      jwt-audiences:
        - "slim"
        - "slim-mesh"
      
      # OPTIONAL: Specific trust domains to include
      # If not specified, all trust domains are accepted
      trust-domains:
        - "example.org"
        - "partner.com"
  
  # ============================================================================
  # CHANNELS CONFIGURATION
  # ============================================================================
  # OPTIONAL: List of SLIM channels to create and manage
  # If no channels are defined, the exporter will:
  #   - Listen for channel invitations from other participants
  #   - Join channels when invited
  #   - Not create any channels on its own
  channels:
    # Example 1: Metrics channel with multiple participants
    - # REQUIRED: Unique name for the SLIM channel
      channel-name: "agntcy/otel/channel-metrics"
      
      # REQUIRED: Signal type for this channel
      # Options: metrics, traces, logs
      # Only telemetry of this type will be sent through this channel
      signal: metrics
      
      # REQUIRED: List of participant names to invite to this channel
      # These names must match the receiver-name or exporter-name of other participants
      participants:
        - "agntcy/otel/receiver"
        - "agntcy/otel/another-receiver"
      
      # OPTIONAL: Enable or disable MLS (Message Layer Security) for this channel
      # Default: true
      # When enabled, all messages in the channel are encrypted end-to-end
      mls-enabled: true
    
    # Example 2: Traces channel
    - channel-name: "agntcy/otel/channel-traces"
      signal: traces
      participants:
        - "agntcy/otel/receiver"
      mls-enabled: true
    
    # Example 3: Logs channel with MLS disabled
    - channel-name: "agntcy/otel/channel-logs"
      signal: logs
      participants:
        - "agntcy/otel/receiver"
        - "agntcy/otel/log-aggregator"
      mls-enabled: false
    
    # You can define multiple channels for the same signal type
    # For example, to send metrics to different groups of receivers:
    # - channel-name: "agntcy/otel/channel-metrics-prod"
    #   signal: metrics
    #   participants:
    #     - "agntcy/otel/prod-receiver-1"
    #     - "agntcy/otel/prod-receiver-2"
    #   mls-enabled: true
    # 
    # - channel-name: "agntcy/otel/channel-metrics-dev"
    #   signal: metrics
    #   participants:
    #     - "agntcy/otel/dev-receiver"
    #   mls-enabled: false
